<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>財務績效視覺化儀表板</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (圖標庫) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 自定義配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        corp: {
                            900: '#0f172a', // Sidebar bg
                            800: '#1e293b', // Sidebar item bg
                            700: '#334155', // Hover
                            600: '#2563eb', // Active Highlight (Blue)
                            50: '#f8fafc',  // Main bg
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Microsoft JhengHei', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* 簡單的淡入動畫 */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0.5; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 隱藏滾動條但保持功能 (Optional) */
        .no-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .no-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .no-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-corp-50 text-slate-800 h-screen overflow-hidden flex font-sans">

    <!-- 左側導航欄 (Sidebar) - 佔寬 25% (在大螢幕上固定寬度較佳，此處設為 w-72 約 280px) -->
    <aside class="w-72 bg-corp-900 text-slate-300 flex flex-col shadow-2xl z-20 transition-all duration-300">
        
        <!-- Logo / 標題區 -->
        <div class="p-6 border-b border-slate-700 bg-corp-900 z-10">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg text-white">
                    <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-white font-bold text-lg tracking-wide">財務戰情室</h1>
                    <p class="text-xs text-slate-400">Financial Dashboard</p>
                </div>
            </div>
        </div>

        <!-- 選單區 -->
        <nav class="flex-1 overflow-y-auto no-scrollbar py-4" id="sidebar-menu">
            <!-- 選單內容將由 JavaScript 動態生成 -->
        </nav>

        <!-- 底部使用者資訊 -->
        <div class="p-4 border-t border-slate-700 bg-corp-900">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-white text-xs font-bold">
                    FM
                </div>
                <div>
                    <p class="text-sm text-white">財務經理</p>
                    <p class="text-xs text-slate-500">View Only Mode</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- 右側展示區 (Main Content) - 佔據剩餘空間 -->
    <main class="flex-1 flex flex-col h-screen relative">
        
        <!-- 頂部資訊列 (Header) -->
        <header class="bg-white h-16 shadow-sm border-b border-slate-200 flex items-center justify-between px-8 z-10">
            <div>
                <!-- 麵包屑導航 -->
                <nav class="flex items-center text-sm text-slate-500">
                    <span class="hover:text-blue-600 cursor-pointer">首頁</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 mx-2"></i>
                    <span id="breadcrumb-category" class="font-medium text-slate-700">類別</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 mx-2"></i>
                    <span id="breadcrumb-item" class="font-bold text-blue-700">項目</span>
                </nav>
            </div>
            <div class="flex items-center gap-4">
                <span id="current-date" class="text-sm text-slate-500 font-mono"></span>
                <button onclick="toggleFullScreen()" class="p-2 text-slate-400 hover:text-blue-600 transition-colors" title="全螢幕">
                    <i data-lucide="expand" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- 圖片展示容器 -->
        <div class="flex-1 p-6 bg-slate-100 overflow-hidden flex flex-col">
            <!-- 圖片卡片 -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 flex-1 flex flex-col overflow-hidden relative group">
                
                <!-- 標題列 -->
                <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white">
                    <h2 id="chart-title" class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="pie-chart" class="w-5 h-5 text-blue-600"></i>
                        <span>載入中...</span>
                    </h2>
                    <div class="flex gap-2">
                         <span class="text-xs font-semibold px-2 py-1 bg-blue-50 text-blue-700 rounded border border-blue-100">Live Data</span>
                    </div>
                </div>

                <!-- 圖片區域 -->
                <div class="flex-1 bg-slate-50 relative overflow-auto flex items-center justify-center p-4">
                    <!-- 這是主要的圖片 -->
                    <img id="main-chart" 
                         src="" 
                         alt="Chart" 
                         class="max-w-full max-h-full object-contain shadow-sm rounded border border-slate-200 fade-in transition-transform duration-300"
                    >
                    
                    <!-- 載入中提示 (隱藏) -->
                    <div id="loading-indicator" class="hidden absolute inset-0 bg-white/80 flex items-center justify-center z-10">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    </div>
                </div>
                
                <!-- 底部備註 -->
                <div class="bg-slate-50 px-6 py-2 border-t border-slate-200 text-xs text-slate-400 flex justify-between">
                    <span>Source: ERP System / Excel Export</span>
                    <span>Last Updated: Today</span>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript 邏輯 -->
    <script>
        // ==========================================
        // 1. 資料設定區 (請在此處替換您的圖片路徑)
        // ==========================================
        const chartData = [
            {
                id: 'cat-1',
                title: '1. 毛利分析',
                icon: 'trending-up',
                items: [
                    { 
                        id: '1-1', 
                        name: '1.1 單月毛利', 
                        // 替換下面的 URL 為您的本地圖片路徑，例如: './images/monthly_profit.png'
                        image: 'https://placehold.co/1000x600/f1f5f9/334155?text=1.1+Monthly+Gross+Margin' 
                    },
                    { 
                        id: '1-2', 
                        name: '1.2 累計毛利', 
                        image: 'https://placehold.co/1000x600/f1f5f9/334155?text=1.2+Cumulative+Gross+Margin' 
                    },
                    { 
                        id: '1-3', 
                        name: '1.3 螺絲釘', 
                        image: 'https://placehold.co/1000x600/f1f5f9/334155?text=1.3+Screws' 
                    }
                ]
            },
            {
                id: 'cat-2',
                title: '2. 製造不良率',
                icon: 'alert-circle',
                items: [
                    { id: '2-1', name: '2.1 A產品', image: 'https://placehold.co/1000x600/fff7ed/9a3412?text=2.1+Product+A+Defect+Rate' },
                    { id: '2-2', name: '2.2 B產品', image: 'https://placehold.co/1000x600/fff7ed/9a3412?text=2.2+Product+B+Defect+Rate' },
                    { id: '2-3', name: '2.3 C產品', image: 'https://placehold.co/1000x600/fff7ed/9a3412?text=2.3+Product+C+Defect+Rate' },
                    { id: '2-4', name: '2.4 D產品', image: 'https://placehold.co/1000x600/fff7ed/9a3412?text=2.4+Product+D+Defect+Rate' },
                    { id: '2-5', name: '2.5 E產品', image: 'https://placehold.co/1000x600/fff7ed/9a3412?text=2.5+Product+E+Defect+Rate' }
                ]
            }
        ];

        // ==========================================
        // 2. 應用程式邏輯
        // ==========================================
        
        const menuContainer = document.getElementById('sidebar-menu');
        const mainImage = document.getElementById('main-chart');
        const chartTitle = document.getElementById('chart-title').querySelector('span');
        const breadcrumbCat = document.getElementById('breadcrumb-category');
        const breadcrumbItem = document.getElementById('breadcrumb-item');
        const loadingIndicator = document.getElementById('loading-indicator');

        // 初始化
        function init() {
            renderMenu();
            updateDate();
            lucide.createIcons();
            
            // 預設載入第一個分類的第一個項目
            const firstGroup = chartData[0];
            const firstItem = firstGroup.items[0];
            loadChart(firstItem.image, firstItem.name, firstGroup.title, firstItem.id);
            
            // 預設展開第一個選單
            toggleGroup(firstGroup.id);
        }

        // 渲染選單
        function renderMenu() {
            let html = '';
            
            chartData.forEach(category => {
                html += `
                    <div class="mb-1">
                        <!-- 主分類按鈕 -->
                        <button onclick="toggleGroup('${category.id}')" 
                                class="w-full flex items-center justify-between px-6 py-3 text-slate-300 hover:bg-slate-800 hover:text-white transition-colors group">
                            <div class="flex items-center gap-3">
                                <i data-lucide="${category.icon}" class="w-4 h-4 text-slate-400 group-hover:text-blue-400"></i>
                                <span class="font-medium tracking-wide">${category.title}</span>
                            </div>
                            <i id="icon-${category.id}" data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300"></i>
                        </button>
                        
                        <!-- 子項目列表 (預設隱藏) -->
                        <div id="group-${category.id}" class="hidden bg-corp-800 overflow-hidden transition-all">
                            <ul class="py-1">
                                ${category.items.map(item => `
                                    <li>
                                        <button id="btn-${item.id}" 
                                                onclick="loadChart('${item.image}', '${item.name}', '${category.title}', '${item.id}')"
                                                class="w-full text-left pl-14 pr-6 py-2.5 text-sm text-slate-400 hover:text-white hover:bg-slate-700/50 transition-colors border-l-4 border-transparent flex items-center justify-between group-sub">
                                            <span>${item.name}</span>
                                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-sub-hover:opacity-100 transition-opacity text-blue-400"></i>
                                        </button>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            });
            
            menuContainer.innerHTML = html;
        }

        // 切換主分類展開/收合
        function toggleGroup(id) {
            const content = document.getElementById(`group-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            
            // 簡單的 Toggle 邏輯
            if (content.classList.contains('hidden')) {
                // 關閉其他已展開的 (可選)
                // document.querySelectorAll('[id^="group-"]').forEach(el => el.classList.add('hidden'));
                // document.querySelectorAll('[id^="icon-"]').forEach(el => el.style.transform = 'rotate(0deg)');

                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // 載入圖片與更新 UI 狀態
        function loadChart(imageUrl, title, categoryTitle, itemId) {
            // 1. 更新按鈕高亮狀態
            // 清除所有高亮
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('bg-blue-900', 'text-white', 'border-blue-500', 'bg-opacity-30');
                btn.classList.add('border-transparent');
            });
            
            // 設定當前高亮
            const activeBtn = document.getElementById(`btn-${itemId}`);
            if (activeBtn) {
                activeBtn.classList.remove('border-transparent');
                activeBtn.classList.add('bg-blue-900', 'bg-opacity-50', 'text-white', 'border-blue-500');
            }

            // 2. 更新文字資訊
            chartTitle.textContent = title;
            breadcrumbCat.textContent = categoryTitle;
            breadcrumbItem.textContent = title;

            // 3. 圖片載入動畫與切換
            loadingIndicator.classList.remove('hidden');
            mainImage.classList.remove('fade-in'); // 重置動畫
            mainImage.style.opacity = '0';

            // 模擬載入延遲 (讓過渡更自然，實際使用時可移除 setTimeout)
            setTimeout(() => {
                mainImage.src = imageUrl;
                
                mainImage.onload = () => {
                    loadingIndicator.classList.add('hidden');
                    mainImage.style.opacity = '1';
                    mainImage.classList.add('fade-in');
                };

                // 處理圖片載入失敗的情況
                mainImage.onerror = () => {
                    loadingIndicator.classList.add('hidden');
                    mainImage.src = 'https://placehold.co/800x400?text=Image+Not+Found';
                    mainImage.style.opacity = '1';
                }
            }, 100);
        }

        // 顯示當前日期
        function updateDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
            document.getElementById('current-date').textContent = dateStr;
        }
        
        // 全螢幕切換
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // 啟動
        init();

    </script>
</body>
</html>
